<div class="modal show" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <span class="close" (click)="onClose()">&times;</span>
    @if (!editMode()) {
      <button class="edit-icon-btn" title="Editar" (click)="onEnterEditMode()">
        <i class="fas fa-pen"></i>
      </button>
    }
    <div class="modal-body">
      <div class="gem-image-container">
        <img
          [src]="gem.image"
          [alt]="gem.name"
          [title]="gem.name"
        />
        <button class="edit-image-btn" title="Cambiar imagen" (click)="onToggleImageUploader()">
          <i class="fas fa-pen"></i>
        </button>
      </div>
      @if (showImageUploader()) {
        <div class="image-uploader">
          <div
            class="dropzone"
            (drop)="onEditDrop($event)"
            (dragover)="onEditDragOver($event)"
          >
            <p>Arrastra y suelta una imagen aquí o</p>
            <label class="file-select">
              <input type="file" accept="image/*" (change)="onEditFileSelected($event)" />
              Buscar imagen
            </label>
            @if (editFilePreview()) {
              <div class="preview">
                <img [src]="editFilePreview()!" alt="Preview" />
                <button type="button" class="remove-preview" (click)="onRemoveEditFile()" title="Quitar imagen">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            }
          </div>
        </div>
      }
      <div class="gem-details">
        @if (!editMode()) {
          <h2>{{ gem.name }}</h2>
          <p class="gem-description">{{ gem.magical_description }}</p>
          <div class="gem-properties">
            <div class="property">
              <i class="fas fa-layer-group"></i>
              <strong>Categoría:</strong>
              <span>{{ gem.category }}</span>
            </div>
            <div class="property">
              <i class="fas fa-palette"></i>
              <strong>Color:</strong>
              <span>{{ gem.color }}</span>
            </div>
            <div class="property">
              <i class="fas fa-atom"></i>
              <strong>Fórmula química:</strong>
              <span>{{ gem.chemical_formula }}</span>
            </div>
          </div>
        } @else {
          <form [formGroup]="editGemForm" class="edit-form">
            <div class="form-row">
              <label for="edit-name">Nombre</label>
              <input id="edit-name" formControlName="name" type="text" />
            </div>
            <div class="form-row">
              <label for="edit-description">Descripción mágica</label>
              <textarea id="edit-description" formControlName="magical_description" rows="4"></textarea>
            </div>
            <div class="form-row">
              <label for="edit-category">Categoría</label>
              <input id="edit-category" formControlName="category" type="text" />
            </div>
            <div class="form-row">
              <label for="edit-color">Color</label>
              <input id="edit-color" formControlName="color" type="text" />
            </div>
            <div class="form-row">
              <label for="edit-formula">Fórmula química</label>
              <input id="edit-formula" formControlName="chemical_formula" type="text" />
            </div>
          </form>
        }
      </div>
    </div>
    @if (editMode()) {
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="onCancelEdit()">
          Cancelar
        </button>
        <button type="button" class="btn btn-primary" (click)="onSaveEdit()">
          Guardar
        </button>
      </div>
    }
  </div>
</div>
